
extraction_prompts = {

"Reason_for_Visit": """
TASK: Extract 'Reason for Visit'.
Respond *only* with a JSON object using this exact schema:
{
"Patient type": "either New patient or follow up"
"second opinion": "whether the visit is consultation/second opinion or not",
"in-person":" either Televisit or in-person. (note, video consult, televisit, telehealth are the same thing",
"summary": "A brief summary of the reason for visit."
}
""",


"What_We_Found": """
TASK: Extract 'What We Found'. 
Respond *only* with a JSON object using this exact schema:
{
"Type_of_Cancer": "list the type of cancer"
"Stage_of_Cancer": "list the stage if it is written in the note",
"Distant Metastasis": "if there is distant metastasis (met)." "Yes, to where; No, local, not sure, need more evidence such as imaging.",
"Metastasis": "if there is met, Yes (to where), No, or Not sure",
"lab_summary": "Summary of key lab results.",
"findings": "Summary of new findings or disease status."
}
""",


"Treatment_Summary": """
TASK: Extract 'Treatment Summary'. 
Respond *only* with a JSON object using this exact schema:
{
"current_meds": "List of current oncologic medications or regimens.",
"recent_changes": "Any holds, dose reductions, or switches.",
"supportive_meds": "List of supportive medications."
}
""",


"Goals of care": """
TASK: Extract 'What We Discussed / Decided'.
Respond *only* with a JSON object using this exact schema:
{
"goals_of_treatment": "eg, cancer is not curable, but it's treatable and the goal is to extend the duration and maintain the quality of life",
"response_assessment": "How the cancer is responding to the treatment, not responding or responding.",
}
""",
}

plan_extraction_prompts = {
"Medication_Plan": """
TASK: Extract the 'Medication Plan' from the given 'Assessment/Plan' section.
Include all current and future medication plans for both cancer therapy and supportive treatment. Cancer treatment could be one or many in chemotherapy, hormone therapy, bone therapy, radiotherapy (eg. rad onc, xrt). Supportive treatment could be one or many in bowel regimen, pain medication, psychiatry medication, neuropathy or any blood transfusion plan. 

Include whether a medication is being started now (e.g,“will start”, “Rx sent”, “starting today” ), plan or discuss in the future after certain condition (e.g., “plan to start after radiation”, “discussed addition of…”), continue or maintained(“continue”), stop or change.

Include an alterative, second-line or clinical trials options if dicussed.

Respond *only* with a JSON object using this exact schema:
{
    "The medication/treatment, one of chemotherapy, hormone therapy, bone therapy, radiotherapy": 
{"summary":"the summary of this type of medication, including start/stop/cotinue if applicable",
"Short term side_effects_discussed": "short term Side effects of this particular medications.",
"Long term side_effects_discussed": "long term Side effects of this particular medications.."}
}
""",

"Medication_Plan": """
TASK: Extract the 'Medication Plan'. Find the 'Assessment/Plan' section of the note, usually the final section.
Include future medication plans, changes to current meds (start, stop, continue), supportive meds, bowel regimen, and any blood transfusion plan.
Respond *only* with a JSON object using this exact schema:
{
    "medication_plan": "A summary of the complete medication plan."
}
""",



"Procedure_Plan": """
TASK: Extract the 'Procedure Plan' from the given 'Assessment/Plan' section.
Include future procedures including surgery, radiation therapy, or interventional procedures such as biopsy, lumbar puncture, or Chemo Port Insertion. 
Do not include imaging plan, lab plan, or medication plan.
Respond *only* with a JSON object using this exact schema:
{
    "procedure_plan": "A summary of any planned procedures."
}
""",



"Imaging Plan": """
TASK: Extract the 'Imaging Plan' from the given 'Assessment/Plan' section.
Include all future imaging like CT, MRI, PET/CT, ultrasound,  DEXA scans, including timing and rationale if mentioned.
Do not include any procedure plan, lab plan, or medication plan.
Respond *only* with a JSON object using this exact schema:
{
    "imaging_plan": "A summary of any planned procedures."
}
""",



"Lab Plan": """
TASK: Extract the 'lab Plan' from the given 'Assessment/Plan' section.
Include future labs like CBC, CMP, tumor markers, coagulation profile, etc. Specify frequency and rationale if mentioned.
Do not include any procedure plan, medication plan, or imagining plan.
Respond *only* with a JSON object using this exact schema:
{
    "lab_plan": "A summary of the future lab plan."
}
""",



"Genetic_Testing_Plan": """
TASK: Extract the 'Genetic Testing Plan' from the given 'Assessment/Plan' section.

1. Scope of section:
- First, find the 'Assessment/Plan' section of the note (usually the final section).
- Only look for plans that are clearly about FUTURE genetic or molecular TESTING.

2. What COUNTS as 'genetic or molecular testing':
- Diagnostic, prognostic, or predictive laboratory assays, such as:
  - Tumor genomic sequencing / NGS / panel testing
  - Germline genetic panels (e.g., hereditary cancer panel, BRCA testing)
  - Liquid biopsy / circulating tumor DNA (ctDNA) tests
  - Specific biomarker tests (e.g., PD-L1 testing, MSI testing, EGFR mutation testing)
  - Any plan to "send", "order", "check", or "obtain" a genetic, genomic, or molecular TEST

3. What MUST be EXCLUDED:
- DO NOT include any medications, systemic therapies, or treatment plans:
  - Chemotherapy, immunotherapy, targeted therapies (e.g., FGFR inhibitor, PARP inhibitor, CDK4/6 inhibitor, TKIs)
  - Hormonal therapy, radiation therapy, surgery
  - Clinical trial options, even if the trial involves targeted drugs or inhibitors
- DO NOT include tests that are already completed, historic, or only mentioned in past oncology history.
- DO NOT include imaging (CT, PET, MRI, X-ray, ultrasound) or routine labs (CBC, CMP, etc.).

4. If there is NO new genetic or molecular test planned in the Assessment/Plan:
- Set the value to a clear negative statement, for example:
  "No new genetic or molecular tests were planned during this visit."

5. Output format:
Respond *only* with a JSON object using this exact schema:
{
    "genetic_testing_plan": "A summary of any future planned genetic or molecular tests, or a clear statement that none are planned."
}
""",




"Referral": """
TASK: Extract 'Referral' from the given 'Assessment/Plan' section.

Respond *only* with a JSON object using this exact schema:
{
"Nutrition": "any nutration referrals such as diet optimization, appetite, weight maintenance), "Genetics": "eg, germline testing, family counseling",
"Specialty": "eg, Palliative care (symptom or pain management, goals of care), Radiation oncology, surgical oncology, Psychology, psychiatry for coping and mood support"
"Others": "Physical or occupational therapy, Social work, financial counseling}
""",



"follow up/next visit": """
TASK: Extract the 'follow up/next visit' from the given 'Assessment/Plan' section.

Respond *only* with a JSON object using this exact schema:
{
    "Next clinic visit": "(in-person or telehealth): timing and purpose"
}
""",



"Advance care planning": """
TASK: Extract the 'Advance care planning' from the given 'Assessment/Plan' section.
Include Advance directives, health-care proxy, code status (if appropriate)、
Respond *only* with a JSON object using this exact schema:
{
    "Advance care": "A summary of any planned Advance care."
}
""",

}















Processing row 45/5...
keypoints






















============================================================
RESULTS FOR ROW 45
============================================================

--- Column: keypoints ---
{
  "Reason_for_Visit": {
    "Patient type": "New patient",
    "second opinion": "Yes",
    "in-person": "Televisit",
    "summary": "Patient presents with new patient evaluation"
  },
  "What_We_Found": {
    "Type_of_Cancer": "Malignant neoplasm of overlapping sites of right breast in female, estrogen receptor negative",
    "Stage_of_Cancer": "Stage IIIB",
    "Distant Metastasis": "Yes, to the lung and right hilar lymph node",
    "Metastasis": "Yes, to the lung and right hilar lymph node",
    "lab_summary": "No lab results mentioned",
    "findings": "Metastatic triple negative breast cancer to the lung and right hilar lymph node"
  },
  "Treatment_Summary": {
    "current_meds": "Xeloda",
    "recent_changes": "Started on taxol, but did not complete due to progression",
    "supportive_meds": "Reishi mushroom, Papaya enzymes, Mullein extract"
  },
  "Goals of care": {
    "goals_of_treatment": "We discussed how metastatic breast cancer is not curable but is treatable. The goal is to extend the duration and maintain the quality of life.",
    "response_assessment": "We discussed how the cancer is not responding to the current treatment (taxol) and the patient has had progression."
  },
  "Medication_Plan": {
    "medication_plan": "I recommend starting on ***** and gemzar carboplatin asap. Second line she could use ***** or other options such as eribulin or doxil for more advanced line treatment."
  },
  "Procedure_Plan": {
    "procedure_plan": "Lumpectomy and axillary lymph node dissection (ALND)"
  },
  "Imaging Plan": {
    "imaging_plan": "No imaging plan mentioned."
  },
  "Lab Plan": {
    "lab_plan": "No specific lab plan mentioned in the note."
  },
  "Genetic_Testing_Plan": {
    "genetic_testing_plan": "No new genetic or molecular tests were planned during this visit."
  },
  "Referral": {
    "Nutrition": "anti inflammatory and /or diabetes risk reducing diet",
    "Genetics": "",
    "Specialty": "",
    "Others": ""
  },
  "follow up/next visit": {
    "Next clinic visit": "Not specified"
  },
  "Advance care planning": {
    "Advance care": "We discussed how metastatic breast cancer is not curable but is treatable."
  }
}

Processing row 46/5...
keypoints






















============================================================
RESULTS FOR ROW 46
============================================================

--- Column: keypoints ---
{
  "Reason_for_Visit": {
    "Patient type": "Follow up",
    "second opinion": "no",
    "in-person": "in-person",
    "summary": "Follow up for services provided by the physician and to discuss pathology in detail, re-excision, and further treatment plan."
  },
  "What_We_Found": {
    "Type_of_Cancer": "Invasive ductal carcinoma (IDC)",
    "Stage_of_Cancer": "pT2",
    "Distant Metastasis": "No, local, not sure, need more evidence such as imaging.",
    "Metastasis": "Yes (to axillary lymph nodes)",
    "lab_summary": "eGFR is likely between 59-120 mL/min, Vitamin D level is 36, CRP is elevated at 5.6 mg/L",
    "findings": "Residual disease with positive margins, 2/2 positive nodes with extranodal extension"
  },
  "Treatment_Summary": {
    "current_meds": "Letrozole, Taxol, Abemaciclib",
    "recent_changes": "Started letrozole, will start abemaciclib after xrt",
    "supportive_meds": "Naproxen, APAP, Allegra, Tramadol"
  },
  "Goals of care": {
    "goals_of_treatment": "The goal of treatment is to re-excise the margins, and to start letrozole and abemaciclib after completion of xrt.",
    "response_assessment": "The cancer is responding to the treatment, as evidenced by the decrease in size and avidity of the right upper inner malignancy."
  },
  "Medication_Plan": {
    "medication_plan": "We will have her start letrozole now. Continue naproxen 500mg bid, APAP ok if taken sparingly. Discussed tramadol if pain worsens/uncontrolled."
  },
  "Procedure_Plan": {
    "procedure_plan": "Right breast cancer S/p right partial mastectomy with re-excision of margins, re-excision of margins, and axillary dissection (if recommended)"
  },
  "Imaging Plan": {
    "imaging_plan": "Bronchoscopy, CT abd angiogram, PFT, chest imaging, sarcoid related blood tests, DEXA scan"
  },
  "Lab Plan": {
    "lab_plan": "Baseline dexa ordered."
  },
  "Genetic_Testing_Plan": {
    "genetic_testing_plan": "Baseline dexa ordered."
  },
  "Referral": {
    "Nutrition": null,
    "Genetics": null,
    "Specialty": "Radiation oncology, Rheumatology, Sarcoid clinic"
  },
  "follow up/next visit": {
    "Next clinic visit": "Re-excision of margins: in-person, timing not specified"
  },
  "Advance care planning": {
    "Advance care": "No advance care planning mentioned."
  }
}

Processing row 54/5...
keypoints






















============================================================
RESULTS FOR ROW 54
============================================================

--- Column: keypoints ---
{
  "Reason_for_Visit": {
    "Patient type": "Follow up",
    "second opinion": "No",
    "in-person": "in-person",
    "summary": "returning to clinic for regular f/u"
  },
  "What_We_Found": {
    "Type_of_Cancer": "IDC (infiltrating ductal carcinoma)",
    "Stage_of_Cancer": "oligometastatic",
    "Distant_Metastasis": "Yes, to bone",
    "Metastasis": "Yes, to bone",
    "lab_summary": "BRCA2 mutation positive, PET/CT: significant improvement in FDG-avidity in left breast soft tissue densities, but diffuse mild tracer activity remains",
    "findings": "Oligometastatic IDC of left breast and T6, residual grade 1 IDC with cellularity of ~10%, ER+ 50%, PR-, HER2- (IHC 2; FISH ratio 1.4), and Ki-67 1%; 7 cm of residual high nuclear grade DCIS with treatment effect present"
  },
  "Treatment_Summary": {
    "current_meds": "leuprolide, letrozole, zoledronic acid, melatonin, multivitamin, oxyCODONE, traZODone",
    "recent_changes": "Patient is weaning off oxyCODONE, LORazepam, acetaminophen, and docusate sodium.",
    "supportive_meds": "melatonin, multivitamin"
  },
  "Goals of care": {
    "goals_of_treatment": "prolongation of life, while maintaining a good quality of life without excessive toxicities",
    "response_assessment": "The cancer is treatable, with primary goals of prolongation of life, while maintaining a good quality of life without excessive toxicities"
  },
  "Medication_Plan": {
    "medication_plan": "Oligometastatic IDC of left breast and T6 - continue leuprolide every 4 weeks, continue letrozole, start palbociclib after radiation, zoledronic acid every 3 months, calcium 1250 mg daily, vitamin D 1000 to 2000 units daily"
  },
  "Procedure_Plan": {
    "procedure_plan": "Bilateral mastectomies with left mastectomy, radiation to T6, and start of palbociclib after radiation"
  },
  "Imaging Plan": {
    "imaging_plan": "PET/CT in ~3-4 months after radiation, DEXA scan (re-ordered)"
  },
  "Lab Plan": {
    "lab_plan": "DEXA scan (re-ordered), CBC, CMP, tumor markers, coagulation profile"
  },
  "Genetic_Testing_Plan": {
    "genetic_testing_plan": "No new genetic or molecular tests were planned during this visit."
  },
  "Referral": {
    "Nutrition": "",
    "Genetics": "",
    "Specialty": "Radiation oncology",
    "Others": ""
  },
  "follow up/next visit": {
    "Next clinic visit": "in 4 weeks"
  },
  "Advance care planning": {
    "Advance care": "There is no mention of advance care planning in the provided note."
  }
}

Processing row 71/5...
keypoints






















============================================================
RESULTS FOR ROW 71
============================================================

--- Column: keypoints ---
{
  "Reason_for_Visit": {
    "Patient type": "Follow up",
    "second opinion": "no",
    "in-person": "Televisit",
    "summary": "consultation regarding further management of breast cancer"
  },
  "What_We_Found": {
    "Type_of_Cancer": "invasive ductal ca",
    "Stage_of_Cancer": "IIIB",
    "Distant Metastasis": "No, local, not sure, need more evidence such as imaging.",
    "Metastasis": "Yes, to rib",
    "lab_summary": "ER positive (strong, 90-100%), PR positive (mod, 1-10%), HER2 negative (IHC 1+), bone scan = negative, CT (C/A/P) = left breast 2.4cm tumor with left axillary lymph nodes up to 1.7cm and left subpectoral lymph nodes, PET-CT = intensely hypermetabolic left breast tumor, Axillary and subpectoral lymph nodes, and small left 5th rib lytic with faint FDG.",
    "findings": "locally advanced disease, a rib finding on the PET scan may or may not be a site of metastasis"
  },
  "Treatment_Summary": {
    "current_meds": "Neo-adjuvant AC/taxol chemotherapy",
    "recent_changes": "Started 2 weeks ago, with GCSF support d3-9",
    "supportive_meds": "Zofran PRN"
  },
  "Goals of care": {
    "goals_of_treatment": "The goal is to reduce the risk of recurrence and mortality from the cancer, and to extend the duration and maintain the quality of life.",
    "response_assessment": "The cancer is responding to the treatment."
  },
  "Medication_Plan": {
    "medication_plan": "She will be having surgery after the completion of neo-adjuvant chemotherapy. She has already started on neo-adjuvant AC/taxol chemotherapy. This consists of 4 cycles of AC at 60/600 mg/m2 given every 2 weeks with growth factor support followed by taxol given either in 4 doses of 175mg/m2 q2weeks or in 12 weekly doses of 80mg/m2. Side effects were discussed including a potential for nausea, vomiting, alopecia, immune suppression and infections, fatigue, neuropathy."
  },
  "Procedure_Plan": {
    "procedure_plan": "She will be having surgery after the completion of neo-adjuvant chemotherapy. Considering her locally advanced disease, it may be wise to perform an axillary"
  },
  "Imaging Plan": {
    "imaging_plan": "PET scan to confirm the presence of metastasis, possibly followed by CT, MRI, or ultrasound if more convincing and accessible sites of distant metastasis present themselves in the future."
  },
  "Lab Plan": {
    "lab_plan": "CBC, CMP, tumor markers, coagulation profile, and possibly others as needed for monitoring the patient's response to treatment and potential side effects of chemotherapy."
  },
  "Genetic_Testing_Plan": {
    "genetic_testing_plan": "No new genetic or molecular tests were planned during this visit."
  },
  "Referral": {
    "Nutrition": "",
    "Genetics": "",
    "Specialty": "Radiation oncology, surgical oncology, Psychology, psychiatry",
    "Others": ""
  },
  "follow up/next visit": {
    "Next clinic visit": "Not specified"
  },
  "Advance care planning": {
    "Advance care": "There is no mention of advance care planning in the provided note."
  }
}

Processing row 84/5...
keypoints






















============================================================
RESULTS FOR ROW 84
============================================================

--- Column: keypoints ---
{
  "Reason_for_Visit": {
    "Patient type": "Follow up",
    "second opinion": "No",
    "in-person": "Televisit",
    "summary": "Ongoing management and treatment of metastatic breast cancer"
  },
  "What_We_Found": {
    "Type_of_Cancer": "Metastatic breast cancer",
    "Stage_of_Cancer": "Not specified",
    "Distant Metastasis": "Yes, to bone, liver, soft tissue, and possibly meninges",
    "Metastasis": "Yes, to bone, liver, soft tissue, and possibly meninges",
    "lab_summary": "WBC 7.0, Hg 8.4, Plt 80, Cr 0.53, Tbili 1.2, ALT 23, CA 15-3 43",
    "findings": "Extensive lytic bone lesions, metastatic disease to the liver and pachymeninges, and possibly to the leptomeninges, diffuse irregular enhancement along the bilateral cerebral convexities and right petroclival region, and nodular enhancement filling the right internal auditory canal"
  },
  "Treatment_Summary": {
    "current_meds": "capecitabine (XELODA) 1500 mg BID, zolendronic acid 4 mg monthly x 3 then every 3 months",
    "recent_changes": "switched from letrozole/palbociclib to Xeloda (initially 500mg BID, then 1000mg BID in mid-September, and 1500 mg BID since late September)",
    "supportive_meds": "atorvastatin (LIPITOR) 20 mg tablet, citalopram (CELEXA) 40 mg tablet, cyclobenzaprine (FLEXERIL) 5 mg tablet, dalfampridine 10 mg 12 hr tablet, interferon beta-1a (AVONEX) 30 mcg/0.5 mL injection, lamoTRIgine (LAMICTAL) 150 mg tablet"
  },
  "Goals of care": {
    "goals_of_treatment": "We explained that metastatic breast cancer is not curable, but it is treatable and there are therapies that will extend the quality and duration of life.",
    "response_assessment": "The patient's cancer is not responding to the current treatment, as evidenced by progression of disease in the liver and lymph nodes, and worsening of symptoms."
  },
  "Medication_Plan": {
    "medication_plan": "Patient is currently on Xeloda 1500mg BID. No other medication plans mentioned."
  },
  "Procedure_Plan": {
    "procedure_plan": "We discussed the possibility of a lumbar puncture to obtain a CSF cytology to confirm the presence of leptomeningeal disease."
  },
  "Imaging Plan": {
    "imaging_plan": "Recent brain MRIs on 09/29/20 and 11/07/20, with a plan for future imaging not specified."
  },
  "Lab Plan": {
    "lab_plan": "No specific lab plan mentioned in the note."
  },
  "Genetic_Testing_Plan": {
    "genetic_testing_plan": "No new genetic or molecular tests were planned during this visit."
  },
  "Referral": {
    "Nutrition": "",
    "Genetics": "",
    "Specialty": "",
    "Others": ""
  },
  "follow up/next visit": {
    "Next clinic visit": "Not mentioned"
  },
  "Advance care planning": {
    "Advance care": "There is no mention of advance care planning in the provided note."
  }
}
